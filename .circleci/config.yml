version: 2.1
aliases:
  ### RUN COMMANDS
  - &clean-build
     "clean install"
orbs:
  maven: circleci/maven@0.0.8

executors:
  # Use machine-executor if you run tests inside testcontainers.
  machine-executor:
    machine: true
  java-11:
    docker:
      - image: circleci/openjdk:11-jdk
        environment:
          _JAVA_OPTIONS: -Xmx1024m
          TERM: dumb
          TZ: "/usr/share/zoneinfo/Europe/Stockholm"
  entur-cci-toolbox:
    docker:
      - image: entur/cci-toolbox:2.0

jobs:
  build:
    executor: java-11
    steps:
      - checkout
      - maven/with_cache:
          settings_file: ./circleci/settings.xml
          steps:
            - run: *clean-build
      - persist_to_workspace:
          root:  ~/project
          paths:
            - target
            - pom.xml
            - .circleci

workflows:
  version: 2.1
  release:
    jobs:
    - build:
        name: build-release
        context: global
        filters:
          branches:
            only:
              - /helm-charts/.*/